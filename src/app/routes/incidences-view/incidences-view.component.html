<div class="main-container">
  <div class="row">
    <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 p-0">

      <div class="col-12 p-0">
        <div class="card">
          <div class="row">
            <div class="col-3 center ">
              <em *ngIf="technicalIncidence.length > 0" class="fa-7x icon-settings "></em>
              <em *ngIf="agriculturalIncidence.length  > 0 " class="fa-7x fab fa-envira "></em>
            </div>
            <div class="col p-0">
              <div *ngIf="Incidence">
                <h4>Reporte de origen</h4>
                <div class="row">
                  <div class="col p-0">
                    <p>{{Incidence.description}}</p>
                    <p>{{Incidence.datetime | date: 'dd/mm/yyyy'}}</p>
                    <p>{{Incidence.field_name}}</p>
                  </div>
                  <div class="col">
                    <p>{{Incidence.id}}</p>
                    <p>Estado actual:</p>
                    <p *ngIf="Incidence.type === 'A'">Agricola</p>
                    <p *ngIf="Incidence.type === 'T'">Técnica</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 p-0   ">
          <div class="card">
            <div class="card-body  p-0">
              <ngx-datatable #table class="bootstrap expandable material fullscreen "
                style="height: calc(90vh - 270px); box-shadow: none; width: 100%;" [columnMode]="'force'"
                [headerHeight]="50" [footerHeight]="50" [rowHeight]="60" [scrollbarV]="true" [scrollbarH]="true"
                [rows]='reports'>
                <!-- Column Templates -->
                <ngx-datatable-column name="#" [width]="50" [canAutoResize]="false">
                  <ng-template let-rowIndex="rowIndex" ngx-datatable-cell-template>
                    <strong>{{rowIndex + 1}}</strong>
                  </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="Titulo de incidencia">
                  <ng-template let-row="row" ngx-datatable-cell-template>
                    <p>{{row.name.name}}</p>
                  </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="Fecha">
                  <ng-template let-row="row" ngx-datatable-cell-template>
                    {{row.datetime | date: 'dd/MM/yyyy'}}
                  </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="Acción">
                  <ng-template let-row="row" ngx-datatable-cell-template>
                    <button class="btn btn-primary m-1" type="button" (click)="ViewReport(row)">
                      Ver historial </button>
                  </ng-template>
                </ngx-datatable-column>
              </ngx-datatable>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
      <div class="card">
        <agm-map [latitude]="lat" [longitude]="lng" [zoom]="zoom" [streetViewControl]="true" [mapTypeControl]='true'>
          <!-- <agm-marker *ngFor="let marker of newpaths" [latitude]="marker.lat" [longitude]="marker.lng"
            [opacity]="marker.alpha" [markerDraggable]="false">
          </agm-marker> -->
          <agm-marker *ngIf="reporttechnicalIncidence.lat" [latitude]="reporttechnicalIncidence.lat"
            [longitude]="reporttechnicalIncidence.lng" [opacity]="0.9" [markerDraggable]="false">
          </agm-marker>
          <div *ngFor="let item of ReportsPaths">
            <agm-marker [latitude]="item.lat" [longitude]="item.lng">
              <agm-info-window>
                <div class="info">
                  <p><b>Titulo:</b>{{item.title}}</p>
                  <p><b>observation:</b>{{item.observation}}</p>
                  <p><b>Fecha:</b>{{item.datetime | date:" dd/MM/yyyy"}}</p>
                  <div class="center m-2">
                    <button class="btn btn-info" (click)="showpathing(item)">Ver ruta</button>
                  </div>
                </div>
              </agm-info-window>
            </agm-marker>
          </div>
          <!-- <div *ngFor="let agricultura of incidence.reports"> -->
          <!-- <div *ngIf="agricultura.status === 2">
              <agm-marker [latitude]="item.lat" [longitude]="item.lng" [iconUrl]="alerta">
                <agm-info-window>
                  {{item.title}} <br><b>{{item.datetime | date:" dd/MM/yyyy  hh:mm:ss "}}</b>
                </agm-info-window>
              </agm-marker>
            </div> -->
          <!-- </div> -->
          <agm-polyline *ngFor="let polyline of nestedPaths;let i = index;" [strokeColor]="'#4caf50'">
            <agm-polyline-point *ngFor="let point of polyline" [latitude]="point.lat" [longitude]="point.lng">
            </agm-polyline-point>
          </agm-polyline>
        </agm-map>
      </div>

      <div class="col ">
        <div class="card " *ngIf="type === 'agriculturalIncidence'">
          <div class="card-header">
            <b> Datos del reporte:</b>
          </div>
          <div class="card-body ">
            <div class="row center">
              <div class="col-10 text-center border">
                <p><b>Nombre: </b>{{reportAgricola.name.name}}</p>
                <p><b>Fecha:</b>{{reportAgricola.datetime | date: 'dd-MM-yyyy'}}</p>
                <div class="center">
                  <div class="col-2 text-center">
                    <div *ngIf="reportAgricola.fruit == 1" class="icon " style="color: #008f39">
                      <a class="fas fa-2x fa-square"></a>
                      <b style="color:black">Planta</b>
                    </div>
                    <div *ngIf="reportAgricola.fruit == 2" class="icon " style="color: #ffff00">
                      <a class="fas fa-2x fa-square"></a>
                      <b style="color:black">Planta</b>
                    </div>
                    <div *ngIf="reportAgricola.fruit == 3" class="icon " style="color: #cb3234">
                      <a class="fas fa-2x fa-square"></a>
                      <b style="color:black">Planta</b>
                    </div>
                  </div>
                  <div class="col-2 text-center">
                    <div *ngIf="reportAgricola.ground == 1" class="icon" style="color: #008f39 ">
                      <a class="fas fa-2x fa-square"></a>
                      <b style="color:black">suelo</b>
                    </div>
                    <div *ngIf="reportAgricola.ground == 2" class="icon" style="color: #ffff00 ">
                      <a class="fas fa-2x fa-square"></a>
                      <b style="color:black">suelo</b>
                    </div>
                    <div *ngIf="reportAgricola.ground == 3" class="icon" style="color: #cb3234 ">
                      <a class="fas fa-2x fa-square"></a>
                      <b style="color:black">suelo</b>
                    </div>
                  </div>
                  <div class="col-2 text-center">
                    <div *ngIf="reportAgricola.plant == 1" class="icon" style="color: #008f39">
                      <a class="fas fa-2x fa-square"></a>
                      <b style="color:black">Hoja</b>
                    </div>
                    <div *ngIf="reportAgricola.plant == 2" class="icon" style="color: #ffff00">
                      <a class="fas fa-2x fa-square"></a>
                      <b style="color:black">Hoja</b>
                    </div>
                    <div *ngIf="reportAgricola.plant == 3" class="icon" style="color: #cb3234">
                      <a class="fas fa-2x fa-square"></a>
                      <b style="color:black">Hoja</b>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card" *ngIf="type === 'technicalIncidence'">
          <div class="card-header">
            Datos del reporte
          </div>
          <div class="card-body">
            <div *ngIf="reporttechnicalIncidence.title">
              <b>Titulo:</b> {{reporttechnicalIncidence.title}}
            </div>
            <div *ngIf="reporttechnicalIncidence.observation">
              <b>Obsevación:</b>{{reporttechnicalIncidence.observation}}<br>
            </div>
            <div *ngIf="reporttechnicalIncidence.number">
              <b>Numero de reporte:</b>{{reporttechnicalIncidence.number}}
            </div>
            <div *ngIf="reporttechnicalIncidence === {}" class="center">
              <div>
                Reporte no seleccionado
              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="col ">
        <div *ngIf="agriculturalIncidence.length > 0">
          <div *ngFor="let item of agriculturalIncidence">
            <div class="card ">
              <div class="row m-3">
                <div class="col-3 center">
                  <em class="fa-6x fab fa-envira"></em>
                </div>
                <div class="col m-0 p-0 text-incidencia">
                  <div>
                    <p><b>Tipo de incidencia:</b><small>{{item.name.name}}</small></p>
                    <p><b>Fecha:</b><small>{{item.datetime | date: 'dd/MM/yyyy'}}</small></p>
                  </div>
                </div>
              </div>
              <div>
                <div class="container text-center m-3">
                  <div class="row center">
                    <div class="col-2 text-center">
                      <div *ngIf="item.fruit == 1" class="icon center" style="color: #008f39">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">Planta</b>
                      </div>
                      <div *ngIf="item.fruit == 2" class="icon center" style="color: #ffff00">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">Planta</b>
                      </div>
                      <div *ngIf="item.fruit == 3" class="icon center" style="color: #cb3234">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">Planta</b>
                      </div>
                    </div>
                    <div class="col-2 text-center">
                      <div *ngIf="item.ground == 1" class="icon center" style="color: #008f39 ">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">suelo</b>
                      </div>
                      <div *ngIf="item.ground == 2" class="icon center" style="color: #ffff00 ">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">suelo</b>
                      </div>
                      <div *ngIf="item.ground == 3" class="icon center" style="color: #cb3234 ">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">suelo</b>
                      </div>
                    </div>
                    <div class="col-2 text-center">
                      <div *ngIf="item.stem === 1" class="icon center" style="color: #008f39 ">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">Tallo</b>
                      </div>
                      <div *ngIf="item.stem === 2" class="icon center" style="color: #ffff00 ">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">Tallo</b>
                      </div>
                      <div *ngIf="item.stem === 3" class="icon center" style="color: #cb3234 ">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">Tallo</b>
                      </div>
                    </div>
                    <div class="col-2 text-center">
                      <div *ngIf="item.leaf == 1" class="icon center" style="color: #008f39">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">Hoja</b>
                      </div>
                      <div *ngIf="item.leaf == 2" class="icon center" style="color: #ffff00">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">Hoja</b>
                      </div>
                      <div *ngIf="item.leaf == 3" class="icon center" style="color: #cb3234">
                        <a class="fas fa-2x fa-square"></a>
                        <b style="color:black;margin-left:4px;">Hoja</b>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="type === 'technicalIncidence'">
          <div *ngFor="let item of technicalIncidence">
            <div class="card ">
              <div class="row m-3">
                <div class="col-3 center">
                  <em class="fa-6x fab icon-settings"></em>
                </div>
                <div class="col m-0 p-0 text-incidencia">
                  <div>
                    <p><b>Tipo de incidencia:</b><small>{{item.name.name}}</small></p>
                    <p><b>Fecha:</b><small>{{item.datetime | date: 'dd/MM/yyyy'}}</small></p>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>